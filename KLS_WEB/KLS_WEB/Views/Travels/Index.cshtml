@{
    ViewData["Title"] = "Viajes";
}

<style>
    .select2-selection__choice__display {
        font-size: 12px;
    }
</style>

<div class="data-content">
    <div class="p-4">
        <div class="text-left mb-3">
            <div class="text-uppercase poppins medium size-24 pl-2">Viajes</div>
        </div>

        <div class="p-4 shadow bg-white">
            <div class="row">
                <div class="col-6 d-flex flex-row">
                    <div class="w-100">
                        <label for="editcliente" class="form-label size-12 font-weight-bold float-left">FILTRAR POR ESTATUS</label>
                        <select class="form-control form-control-sm cliente" style="width: 100%;" id="filtro" name="filtro[]" multiple="multiple" onchange="DT(null, this)" data-selected-text-format="count" data-live-search="true"></select>
                    </div>
                    <div class="w-50">
                        <input type="search" class="form-control my-4 ml-3" style="background-color:#EDECEC; height: 2.3rem;" placeholder="Buscar" onkeyup="DT(this.value)">
                    </div>
                </div>
                <div class="col-6 d-flex flex-row">
                    <div class="my-auto w-100 justify-content-end">
                        <a href="/Travels/AddEdit/0/0" class="btn btn-sm btn-outline-secondary float-right"><span class="material-icons">add</span></a>
                    </div>
                </div>
            </div>
            <table id="table" class="table table-striped table-bordered display table-hover table-viajes text-uppercase" width="100%">
                <thead>
                    <tr>
                        <th>ID Viaje</th>
                        <th>Cliente</th>
                        <th>Origen</th>
                        <th>Destino</th>
                        <th>Fecha Salida</th>
                        <th>Fecha Llegada</th>
                        <th>Estatus</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="table-info"></tbody>
            </table>
        </div>

    </div>
</div>

@section Scripts{
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <!-- (Optional) Latest compiled and minified JavaScript translation files -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-es_ES.min.js"></script>
    <script>
        $(document).ready(function (event) {
            DT();
            getSubstatus();
        });

        const getSubstatus = async () => {
            try {
                const response = await fetch('/Travels/GetSubstatuses')
                const data = await response.json()
                let filter = '';
                data && data.map(({ id, name, status }) => {
                    filter += `<option value="${id}">${status.name} - ${name}</option>`;
                }), $('#filtro').html(filter).selectpicker()
            } catch (error) {
                console.error(error)
            }
        }

        const DT = (keyword = null, filter) => {
            Table = $('#table').DataTable({
                destroy: true,
                responsive: true,
                autoWidth: true,
                processing: true,
                serverSide: true,
                dom: 'Btp',
                ajax: {
                    type: 'POST',
                    url: '/Travels/DataTableTravels',
                    data: data => {
                        if (keyword) {
                            data.search.value = keyword;
                        }
                        if (filter) {
                            data.filter = $(filter).val();
                        }
                    }
                },
                columns: [
                    { data: 'folio' },
                    { data: 'cliente' },
                    { data: 'origen' },
                    { data: 'destino' },
                    { data: 'fechaSalida' },
                    { data: 'fechaLlegada' },
                    {
                        data: 'estatus',
                        render: (estatus, type, full, meta) => `<span class="text-primary font-weight-bold">${estatus}</span>`
                    },
                    {
                        render: (data, type, row) => {
                            const { mainTravelId, id } = row;

                            return `<a href="/Travels/AddEdit/${mainTravelId}/${id}"><span class="material-icons">open_in_new</span></a>`;
                        }
                    }
                ],
                language: {
                    url: '/json/dt-es.json'
                },
                initComplete: () => {
                    $('#table_length').html(`<a href="/Travels/AddEdit/0/0" class="btn btn-sm btn-outline-secondary float-right"><span class="material-icons">add</span></a>`).show();
                }
            });
        }
    </script>
} 