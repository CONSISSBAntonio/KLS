@model KLS_WEB.Models.Travels.Travel

@{
    ViewData["Title"] = "Detalles del viaje";
}
<style>
    .card,
    .catalog,
    .bg-white {
        box-shadow: 0px 3px 6px #00000029;
    }

    .dot {
        height: 25px;
        width: 25px;
        background-color: #88C78F;
        border-radius: 50%;
        display: inline-block;
    }

    .catalog-list {
        padding: unset;
        padding-left: inherit;
    }

    .catalog {
        width: 10.6rem !important;
        height: 9.7rem !important;
    }

    label {
        text-align: left;
    }

    .form-check-label {
        font-size: 12px !important;
    }

    .select2-selection__rendered {
        float: left;
        font-size: 12px;
        text-transform: uppercase;
    }

    select {
        text-transform: uppercase;
    }

    .wrapper > .data-content {
        text-align: unset;
    }
</style>

<div class="pl-5 pr-5">
    <div class="row">
        <div class="col-5 d-flex justify-content-start align-content-center">
            <a href="/Travels" class="d-flex align-items-center" style="text-decoration: none !important;">
                <i class="material-icons icon-red">arrow_back</i>
            </a>
            <div class="text-uppercase poppins medium size-24 pl-2">Viaje @Model.Folio</div>
        </div>
        <div class="col-7 d-flex justify-content-center align-items-center">
            <div class="card w-75 h-100 d-flex flex-row justify-content-around" onclick="$('#modalEstatus').modal('show')" style="cursor: pointer;">
                <div class="d-flex justify-content-start w-50">
                    <span class="dot my-auto mr-3 ml-3"></span>
                    <h6 class="my-auto justify-content-start" id="estatuslabel"></h6>
                </div>
                <div class="w-50 d-flex justify-content-center align-items-center">
                    <h6 class="my-auto" id="subestatuslabel" style="text-align-last: center;"></h6>
                </div>
            </div>
        </div>
    </div>


    <div class="row">

        <div class="col-5" style="margin-top: 1.3rem;">
            <div class="card p-3">

                <form onsubmit="">
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Folio de viaje</label>
                        <div class="col-7">
                            <input asp-for="Folio" type="text" class="form-control form-control-sm" id="folio"
                                   disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Cliente</label>
                        <div class="col-7">
                            <input asp-for="NombreCliente" type="text" class="form-control form-control-sm" id="cliente"
                                   disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Dirección Origen</label>
                        <div class="col-7">
                            <input asp-for="DireccionRemitente" type="text" class="form-control form-control-sm"
                                   id="direccionorigen" disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Dirección Destino</label>
                        <div class="col-7">
                            <input asp-for="DireccionDestinatario" type="text" class="form-control form-control-sm"
                                   id="direcciondestino" disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Ruta</label>
                        <div class="col-7">
                            <input asp-for="NombreRuta" type="text" class="form-control form-control-sm" id="ruta"
                                   disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Tiempo de ruta (hrs)</label>
                        <div class="col-7">
                            <input asp-for="TiempoRuta" type="number" class="form-control form-control-sm" id="tiemporuta"
                                   disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Fecha Salida</label>
                        <div class="col-7">
                            <input asp-for="Salida" type="text" class="form-control form-control-sm"
                                   id="fechasalida" disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Fecha Entrega</label>
                        <div class="col-7">
                            <input asp-for="Llegada" type="text" class="form-control form-control-sm"
                                   id="fechaentrega" disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Costo</label>
                        <div class="col-7">
                            <input asp-for="Costototal" type="text" class="form-control form-control-sm" id="costo"
                                   disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Precio Cliente</label>
                        <div class="col-7">
                            <input asp-for="Preciototal" type="text" class="form-control form-control-sm"
                                   id="preciocliente" disabled="disabled" required>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-5 col-form-label col-form-label-sm">Tipo de SERVICIO</label>
                        <div class="col-7">
                            <input asp-for="TipoUnidadNombre" type="text" class="form-control form-control-sm"
                                   id="tipounidad" disabled="disabled" required>
                        </div>
                    </div>

                </form>

            </div>
        </div>

        <div class="col-7">
            <div class="catalog-list">

                <a href="javascript:void(0);" class="catalog" id="servicios" onclick="showPanel(this.id), getServicios()">
                    <div class="content">
                        <span class="material-icons">
                            people
                        </span>
                        <div class="name font-barlow">Servicios</div>
                    </div>
                </a>
                <a href="javascript:void(0);" class="catalog" id="requisitos" onclick="showPanel(this.id), getRequisitos()">
                    <div class="content" id="requisitos">
                        <span class="material-icons">
                            inventory_2
                        </span>
                        <div class="name font-barlow">Requisitos</div>
                    </div>
                </a>
                <a href="javascript:void(0);" class="catalog" id="mercancia" onclick="showPanel(this.id); getMercancia(), getMercanciaD()">
                    <div class="content">
                        <span class="material-icons">
                            store
                        </span>
                        <div class="name font-barlow">Mercancía</div>
                    </div>
                </a>

                <a href="javascript:void(0);" class="catalog" id="facturacion" onclick="showPanel(this.id)">
                    <div class="content">
                        <span class="material-icons">
                            receipt_long
                        </span>
                        <div class="name font-barlow">Facturación</div>
                    </div>
                </a>

                <a href="javascript:void(0);" class="catalog" id="documentos" onclick="showPanel(this.id), getEvidencia()">
                    <div class="content">
                        <span class="material-icons">
                            folder
                        </span>
                        <div class="name font-barlow">Documentos</div>
                    </div>
                </a>
                <a href="javascript:void(0);" class="catalog" id="historial" onclick="showPanel(this.id), loadTableHistorial()">
                    <div class="content">
                        <span class="material-icons">
                            manage_search
                        </span>
                        <div class="name font-barlow">Historial</div>
                    </div>
                </a>
                @*<a href="#" class="catalog">
                    <div class="content">
                    <span class="material-icons">
                    pin_drop
                    </span>
                    <div class="name font-barlow">Monitoreo</div>
                    </div>
                    </a>*@
            </div>
        </div>

    </div>

    <div class="row mt-4 bottomPanel">
        @*Facturacion*@
        <div class="col-6 facturacion d-none">
            <div class="text-left d-flex justify-content-between mb-3">
                <h4>FACTURACIÓN</h4>
                <div style="padding-left:20%;" onclick="">
                    <a class="btn btn-sm bg-white" style="font-size:1.8rem;width:3.5rem" href="javascript:void(0);">
                        <span class="material-icons">
                            add
                        </span>
                    </a>
                </div>
            </div>

            <table class="table table-striped table-bordered display table-hover text-uppercase table-facturas" width="100%">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Fecha de carga</th>
                        <th>Usuario</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="facturacionInfo"></tbody>
            </table>
        </div>

        @*Mercancia*@
        <div class="col-12 mercancia mb-5 d-none">
            <div class="text-left d-flex justify-content-start mb-3">
                <h4>MERCANCIA</h4>
            </div>
            <div class="row">
                <div class="col-6 d-flex flex-column justify-content-between">
                    <div class="card mb-3 p-3">
                        <p class="text-left font-weight-bold">DESCRIPCIÓN</p>
                        <form class="row g-3 text-left" onsubmit="">
                            <div class="col-3">
                                <label for="falto" class="form-label">Alto</label>
                                <input type="number" class="form-control" id="falto" name="alto">
                            </div>
                            <div class="col-3">
                                <label for="fancho" class="form-label">Ancho</label>
                                <input type="number" class="form-control" id="fancho" name="ancho">
                            </div>
                            <div class="col-3">
                                <label for="flargo" class="form-label">Largo</label>
                                <input type="number" class="form-control" id="flargo" name="largo">
                            </div>
                            <div class="col-3">
                                <label for="fpeso" class="form-label">Peso</label>
                                <input type="number" class="form-control" id="fpeso" name="peso">
                            </div>
                            <div class="col-3">
                                <label for="fvolumetrico" class="form-label">Peso volumétrico</label>
                                <input type="number" class="form-control" id="fvolumetrico" name="pesovolumetrico">
                            </div>
                            <div class="col-9 d-flex justify-content-end align-items-end">
                                <button class="btn btn-sm btn-link"><i class="material-icons">save</i></button>
                            </div>
                        </form>
                    </div>
                    <div class="card">
                        <form onsubmit="" class="text-left mt-3 pr-4">
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0"><strong>TIPOS</strong></label>
                                </div>
                                <div class="col-6 text-left">
                                    <label class="col-form-label col-form-label-sm pl-0">
                                        <strong>
                                            COMENTARIOS
                                            ADICIONALES
                                        </strong>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm"
                                           name="densidad" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0">DENSIDAD</label>
                                </div>
                                <div class="col-6 text-left">
                                    <select class="form-control form-control-sm" name="densidadval" id="densidad" style="width:100%" disabled>
                                        <option selected disabled>SELECIONAR</option>
                                        <option value="baja">BAJA</option>
                                        <option value="media">MEDIA</option>
                                        <option value="alta">ALTA</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm"
                                           name="tipopresentacion" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0">TIPO PRESENTACIÓN</label>
                                </div>
                                <div class="col-6 text-left">
                                    <select class="form-control form-control-sm" name="tipopresentacionval"
                                            id="tipopresentacion" style="width:100%" disabled>
                                        <option selected disabled>SELECIONAR</option>
                                        <option value="envase">ENVASE</option>
                                        <option value="granel">GRANEL</option>
                                        <option value="tarima">TARIMA</option>
                                        <option value="otros">OTROS</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm"
                                           name="peligroso" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0">PELIGROSO</label>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm"
                                           name="material" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0">MATERIAL</label>
                                </div>
                                <div class="col-6 text-left">
                                    <select class="form-control form-control-sm" name="materialval" id="material"
                                            style="width:100%" disabled>
                                        <option selected disabled>SELECIONAR</option>
                                        <option value="materiaprima">MATERIA PRIMA</option>
                                        <option value="materialdeenvase">MATERIAL DE ENVASE</option>
                                        <option value="productoterminado">PRODUCTO TERMINADO</option>
                                        <option value="perecederos">PERECEDEROS</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm"
                                           name="derramable" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0">DERRAMABLE</label>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm"
                                           name="valor" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0">VALOR</label>
                                </div>
                                <div class="col-6 text-left">
                                    <select class="form-control form-control-sm" name="valorval" id="valor"
                                            style="width:100%" disabled>
                                        <option selected disabled>SELECIONAR</option>
                                        <option value="alto">ALTO</option>
                                        <option value="medio">MEDIO</option>
                                        <option value="bajo">BAJO</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm"
                                           name="custodia" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0">CUSTODIA</label>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-1">
                                    <input type="checkbox" class="custome-check form-control form-control-sm"
                                           name="olorpenetrante" disabled>
                                </div>
                                <div class="col-5">
                                    <label class="col-form-label col-form-label-sm pl-0">OLOR PENETRANTE</label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card col-6 mb-3 p-3">
                    <p class="text-left font-weight-bold">REQUISITOS ESPECIALES</p>
                    <div class="form-floating">
                        <textarea class="form-control" placeholder="OPCIONALES" name="requisitosespeciales"
                                  rows="35" disabled></textarea>
                    </div>
                </div>
            </div>
        </div>


        @* Requisitos *@
        <div class="row requisitos d-none">
            <div class="col-6">
                <h4>REQUISITOS CARGA</h4>

                <div class="p-2 card">
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm"
                                   disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm"><strong>Instrucción</strong></label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="equipoSeguridad" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Equipo de seguridad; chaleco
                            reflejante verde o naranja, casco y botas de casquillo, lentes de seguridad y guantes de
                            seguridad.
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="equipoCovid" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Equipo COVID; guantes, cubrebocas,
                            careta y lentes
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarSua" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">Llevar SUA en fisico</label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarLicencia" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar licencia vigente y en
                            fisico
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarTarjeta" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar tarjeta de circulación de
                            tracto físico
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarCertificado" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar certificado de fumigación
                            impreso
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarGatas" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">Llevar dos gatas</label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarIne" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">Llevar INE</label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarPoliza" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar póliza de seguro en físico
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="contarAlarma" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            contar con alarma de reversa que
                            funcione
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="unidadCondiciones" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">Unidad en buenas condiciones</label>
                    </div>
                </div>
            </div>

            <div class="col-6">
                <h4>REQUISITOS DESCARGA</h4>

                <div class="p-4 shadow bg-white">
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm"><strong>Instrucción</strong></label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="equipoSeguridad_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Equipo de seguridad; chaleco
                            reflejante verde o naranja, casco y botas de casquillo, lentes de seguridad y guantes de
                            seguridad.
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="equipoCovid_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Equipo COVID; guantes, cubrebocas,
                            careta y lentes
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarSua_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">Llevar SUA en fisico</label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarLicencia_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar licencia vigente y en
                            fisico
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarTarjeta_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar tarjeta de circulación de
                            tracto físico
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarCertificado_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar certificado de fumigación
                            impreso
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarGatas_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">Llevar dos gatas</label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarIne_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">Llevar INE</label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarPoliza_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar póliza de segur en
                            físico
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="contarAlarma_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            contar con alarma de reversa que
                            funcione
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="presentarseMin_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Presentarse 40 minutos antes de su
                            descarga
                        </label>
                    </div>
                    <div class="form-group row">
                        <div class="col-1">
                            <input type="checkbox" class="custome-check form-control form-control-sm" name="llevarTodos_" disabled>
                        </div>
                        <label class="col-11 col-form-label col-form-label-sm">
                            Llevar todos los documentos que le
                            dan al cargar: Hoja de remisión, certificado de calidad, certificado del producto
                        </label>
                    </div>
                </div>
            </div>

        </div>

        @*HISTORIAL*@
        <div class="col-12 historial d-none">
            <div class="text-left d-flex justify-content-between mb-3">
                <h4>HISTORIAL</h4>
                <div style="padding-left:20%;" onclick="">
                </div>
            </div>

            <table class="table table-striped table-bordered display table-hover table-historial text-uppercase"
                   width="100%">
                <thead>
                    <tr>
                        <th>REGISTRO</th>
                        <th>USUARIO</th>
                        <th>FECHA</th>
                    </tr>
                </thead>
                <tbody id="historialInfo"></tbody>
            </table>
        </div>


        @* documentos *@
        <div class="col-12 documentos d-none">
            <div class="p-4">
                <h4>DOCUMENTOS</h4>
                <button class="btn btn-dark px-5" style="border-radius:0px" onclick="">Generar carta porte</button>
                <div class="row">
                    <div class="col-6 mt-3">
                        <div class="text-left d-flex justify-content-between">
                            <h4>EVIDENCIA DIGITAL</h4>
                        </div>
                        <div class="p-4 shadow bg-white">
                            <table class="table table-striped table-bordered display table-hover text-uppercase table-evidencia" width="100%">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Fecha de carga</th>
                                        <th>Usuario</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="evidenciaInfo"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-6 mt-1">
                        <div class="text-left d-flex justify-content-between">
                            <h4>EVIDENCIA FÍSICA</h4>
                            <div style="padding-left:20%;">
                                <a class="btn btn-sm bg-white mb-2" href="#">
                                    <span class="material-icons text-primary">
                                        save
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="p-4 shadow bg-white">
                            <div class="row">
                                <div class="col-6">
                                    <div class="d-flex ml-3">
                                        <h6>NOMBRE</h6>
                                    </div>

                                    <div class="d-flex flex-column fisicanombre">
                                        <div class="d-flex align-items-center">
                                            <input type="checkbox" class="custome-check">
                                            <label class="col-form-label col-form-label-sm">Carta de recepción</label>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <input type="checkbox" class="custome-check mt">
                                            <label class="col-form-label col-form-label-sm">Sello de vigilancia</label>
                                        </div>
                                    </div>
                                </div>
                                @*<div class="col-6">
                                        <div class="d-flex">
                                            <h6>TIEMPO DE ENTREGA</h6>
                                        </div>
                                        <div class="d-flex flex-column mt-2 fisicatiempo">
                                            <div class="d-flex align-items-center">
                                                <label class="size-12">Vencida</label>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <label class="size-12">3d 2hrs</label>
                                            </div>
                                        </div>

                                    </div>*@
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @*Servicios*@
        <div class="col-12 servicios d-none mb-5">
            <div class="card p-3">
                <div class="form-group col-12 d-flex justify-content-between">
                    <h6 class="font-weight-bold">SERVICIOS</h6>
                    <div>
                        <button class="btn btn-outline-light btn-sm" onclick="">
                            <i class="material-icons text-primary">save</i>
                        </button>
                        <a class="btn btn-outline-secondary btn-sm" onclick="">
                            <i class="material-icons">add</i>
                        </a>
                    </div>
                </div>
                <div class="form-group col-12 addServicios">
                    <div class="border rounded d-flex justify-content-center align-items-center font-weight-bolder"
                         onclick=""
                         style="border: 5px dashed #585858 !important; height: 7rem; opacity: 0.2; cursor: pointer;">
                        <h3>AGREGA SERVICIOS</h3>
                    </div>

                </div>
                <b class="d-none" id="costos">0.00</b>
                <b class="preciocliente d-none">0.00</b>
                <form class="services">
                    <div class="col-12 serviciosseleccionados d-flex flex-column" style="display: none;"></div>
                </form>
            </div>
        </div>
    </div>
</div>


<!--Modal agregar factura-->
<div class="modal fade" id="modalFactura" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titulo-modal">AGREGAR</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left">
                <form id="formFactura" name="form" enctype="multipart/form-data" method="post">
                    <div class="form-group col-12">
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" name="file" id="customFile" required>
                            <label class="custom-file-label" for="customFile">Seleccione un archivo</label>
                        </div>
                    </div>
                    <br />
                    <a href="javascript:void(0);" class="btn btn-dark guardar" style="width:100%"
                       onclick="">
                        Agregar
                    </a>
                </form>
                @*<form asp-controller="Facturacion" asp-action="UploadFile" method="post"
                    enctype="multipart/form-data">
                    <div class="form-group col-12">
                    <div class="custom-file">
                    <input type="file" class="custom-file-input" name="file" id="customFile">
                    <label class="custom-file-label" for="customFile">Seleccione un archivo</label>
                    </div>
                    </div>
                    <br />
                    <button type="submit" class="btn btn-dark guardar" style="width:100%">Agregar</button>
                    </form>*@
            </div>
        </div>
    </div>
</div>
<!--Modal agregar factura-->
<!--Modal actualizar estado-->
<div class="modal fade" id="modalEstatus" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titulo-modal">CAMBIAR ESTATUS</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left">
                <form id="formEstatus">
                    <div class="row">
                        <div class="col-6 text-left">
                            <b class="size-12">ESTATUS</b>
                            <select class="form-control form-control-sm" name="estatus" id="estatus" style="width:100%" onchange="">
                                <option value="0" selected disabled>SELECIONA</option>
                                <option value="confirmado">CONFIRMADO</option>
                                <option value="entransito">EN TRÁNSITO</option>
                                <option value="concluido">CONCLUIDO</option>
                                <option value="admin">ADMIN</option>
                                <option value="cerrado">CERRADO</option>
                            </select>
                        </div>
                        <div class="col-6 text-left subestatus">
                            <b class="size-12">SUB ESTATUS</b>
                            <select class="form-control form-control-sm" name="subestatus" id="subestatus" style="width:100%">
                                <option selected disabled>SELECCIONA</option>
                            </select>
                        </div>
                    </div>
                    <br />
                    <a href="javascript:void(0);" class="btn btn-dark guardar" style="width:100%" onclick="">
                        GUARDAR
                    </a>
                </form>
            </div>
        </div>
    </div>
</div>
<!--Modal actualizar estado-->
<!--Modal servicio-->
<div class="modal fade" id="modalDiv" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titulo-modal">AGREGAR</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left">
                <form id="frmServicios" class="viaje" onsubmit="">
                    <div class="form-check d-flex align-items-center">
                        <input class="form-check-input my-auto" type="checkbox" id="0" name="terrestrenacional">
                        <label class="form-check-label" for="0">Terrestre nacional</label>
                    </div>
                    @*<div class="form-check">
                            <input class="form-check-input" type="checkbox" id="1" name="naviera">
                            <label class="form-check-label" for="1">
                                Naviera
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="2" name="agenteaduanal">
                            <label class="form-check-label" for="2">
                                Agente aduanal
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="3"
                                   name="terrestreinternacional">
                            <label class="form-check-label" for="3">
                                Terrestre Internacional
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="4" name="aerolinea">
                            <label class="form-check-label" for="4">
                                Aerolinea
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="5" name="coloaders">
                            <label class="form-check-label" for="5">
                                Coloaders
                            </label>
                        </div>*@
                </form>
                <br />
                <button onclick="" class="btn btn-dark" style="width:100%;">
                    Agregar
                </button>

            </div>
        </div>
    </div>
</div>
<!--Modal servicio-->
<!-- Modal confirm delete -->
<div class="modal fade" id="popup" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="titulo-modal"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-left">
                <p>¿Estas seguro de que deseas eliminar el SERVICIO seleccionado?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" data-dismiss="modal">Cerrar</button>
                <button id="confirm" type="button" class="btn">Si</button>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script>
        const TravelId = @TempData["TravelId"] ;
        $(document).ready(function () {
            loadTableFactura();
            getEstatus();
            getEvidencia();
        });

        const GenerateCartaPorte = e => {
            $(e).prop('disabled', true).removeClass('btn-dark').addClass('btn-secondary').html('Generando...');
            fetch(`/Travels/CartaPorte/${TravelId}`)
                .then(response => response.blob())
                .then(blob => {
                    const folio = '@Model.Folio';
                    $(e).prop('disabled', false).removeClass('btn-secondary').addClass('btn-dark').html('Generar carta porte');
                    const data = window.URL.createObjectURL(blob);
                    const anchor = document.createElement('a');
                    anchor.href = data;
                    anchor.download = `${folio} - CartaPorte.pdf`;
                    anchor.click();
                })
        }

        getEvidencia = () => {
            $.get("/Clients/Others/getEvidencia/", { "Id_Cliente": @Model.ClienteId}, response => {
                let nombrehtml = ``
                let tiempohtml = ``;
                let digitalhtml = ``;
                $('.table-evidencia').DataTable().clear().destroy();
                response.map(({ id, estatus, fisica, mandatario, nombre, tiempo_Entrega }) => {
                    !fisica && (
                        $("#evidenciaInfo").append(`
                        <tr>
                        <td>${nombre}</td>
                        <td>${tiempo_Entrega}</td>
                        <td>${estatus === 1 ? 'PENDIENTE' : 'ENTREGADA'}</td>
                        <td class="text-center">
                            <a href="javascript:void(0);" onclick="evidence(${id}, ${TravelId}, 'upload', this);">
                                <span class="material-icons">
                                    file_upload
                                </span>
                            </a>
                            <a href="javascript:void(0);" onclick="evidence(${id}, ${TravelId}, 'download', this);">
                                <span class="material-icons">
                                    file_download
                                </span>
                            </a>
                        </td>
                    </tr>`));
                    nombrehtml += fisica ? `<div class="d-flex align-items-center">
                                    <input type="checkbox" class="custome-check">
                                    <label class="col-form-label col-form-label-sm">${nombre.toUpperCase()}</label>
                                </div>` : '';
                    tiempohtml += fisica ? `<div class="d-flex align-items-center">
                                            <label class="size-12">${tiempo_Entrega}</label>
                                        </div>` : '';
                });

                $('.fisicanombre').empty().html(nombrehtml);
                $('.fisicatiempo').empty().html(tiempohtml);
                dTable('table-evidencia');
                $('.dataTables_length, .dataTables_filter, .dataTables_info').remove();
            });
        }

        getEstatus = () => {
            $.get('/Travels/GetEstatus', { Id: TravelId }, ({ estatus, subEstatus, statusUpdated }) => {
                subEstatus = !subEstatus ? 'REGISTRADO' : subEstatus;
                $('#estatuslabel').text(estatus.toUpperCase());
                $('#subestatuslabel').html(`${subEstatus.toUpperCase()} <br/> (<span class="timeago" datetime="${statusUpdated}"></span>)`);
                timeago.render(document.querySelectorAll('.timeago'), 'es-MX');
            });
        }

        updateStatus = button => {
            if (!validateForm('#formEstatus')) {
                dToast("error", "TODOS LOS CAMPOS SON OBLIGATORIOS", "Error");
                return;
            }

            $(button).prop('disabled', true);
            let data = $('#formEstatus').serialize();
            data += `&Id=${TravelId}`;
            $.post('/Travels/UpdateStatus', data, response => {
                $(button).prop('disabled', false);
                getEstatus();
                $('#modalEstatus').modal('hide');
                loadTableHistorial();
            });
        };

        validateForm = (form) => {
            let isSet = true;
            $(`${form} select, ${form} input`).map((k, { value }) => {
                if (!value || value == 0) {
                    isSet = value === 0 && false;
                    isSet = value === 'cerrado' && true;
                    return;
                }
            });

            return isSet;
        };

        listSubestatus = filter => {
            if (filter === 'cerrado') {
                $('.subestatus').hide();
                return;
            }

            const estatus = {
                'confirmado': ['EN ESPERA DE ASIGNACIÓN'],
                'entransito': ['DESTINO A CARGAR', 'ESPERA DE CARGA', 'CARGANDO', 'A TIEMPO', 'DEMORADO', 'ESPERA DESCARGA', 'DESCARGANDO', 'RECHAZADO PARCIAL', 'RECHAZADO'],
                'concluido': ['SIN EVIDENCIA', 'CON EVIDENCIA DIGITAL'],
                'admin': ['NO FACTURADO'],
                'cerrado': ['CERRADO']
            };
            let options = `<option value="0" selected disabled>SELECCIONA</option>`;
            Object.entries(estatus).map(([k, v]) => k === filter && v.map(x => options += `<option value="${x.toLowerCase()}">${x}</option>`));

            $('#subestatus').empty().append(options);
            $('.subestatus').show();
        }

        validarSelect = () => {
            let isset = true;
            $('.serviciosseleccionados select').map((k, { value }) => {
                if (value == 0) {
                    isset = false;
                    return;
                }
            });
            return isset;
        }

        existenServicios = () => {
            let isset = false;
            $('#frmServicios input').map((k, { checked }) => {
                if (checked) {
                    isset = checked;
                    return;
                }
            });
            return isset;
        }

        getServicesId = () => {
            let ids = [];
            $('.service').map((k, v) => {
                ids = [...ids, parseInt($(v).attr('rel'))];
            });
            return ids;
        }

        updateServicios = e => {
            if (!existenServicios()) {
                dToast("error", "LOS SERVICIOS SON OBLIGATORIOS", "Error");
                return;
            } else if (!validarSelect()) {
                dToast("error", "LOS PARÁMETROS DE LOS SERVICIOS SON OBLIGATORIOS", "Error");
                return;
            }
            $('.service').map((k, v) => {
                let ids = [];
                ids = [...ids, parseInt($(v).attr('rel'))];
            })
            let jsonData = convertJson($(".services"));
            const details = {
                Id: TravelId,
                equipo: getEquipos(),
                unidad: getUnidades(),
                servicios: $('#frmServicios').serialize(),
                preciototal: $('#preciocliente').text(),
                costototal: $('#costos').text(),
                ServicesId: getServicesId()
            };

            jsonData = { ...jsonData, ...details };
            const { servicios, unidad, costototal, preciototal } = jsonData;
            const serviceExists = servicios != '' && unidad != '' && costototal != 0 && preciototal != 0 && true;

            if (serviceExists) {
                $(e).prop('disabled', true);
                $.post("/Travels/setTravels", jsonData, ({ services }) => {
                    dToast("success", "Registro guardado exitosamente.", "Registrado");
                    $(e).attr("disabled", false);
                    services.map(({ id, nombre }) => ($(`.delete${nombre}`).attr('onclick', `confirmDelete('${nombre}', ${id});`), $(`.delete${nombre}`).attr('rel', id)));
                }).fail(function (error) {
                    $(e).attr("disabled", false);
                    dToast("error", "Error al tratar de guardar el registro", "Error");
                    $(".guardar").attr("disabled", false);
                });
            } else {
                const { unidad } = jsonData;
                dToast("error", unidad == '' ? "DEBES SELECCIONAR AL MENOS UNA UNIDAD" : "LOS COSTOS Y PRECIOS NO PUEDEN SER 0", "Error");
                $(".guardar").attr("disabled", false);
            }
        }

        closeModal = (servicios, servicesobject, servicesids) => {
            $('#modalDiv').modal('hide');
            servicios = servicios ? servicios : $('#frmServicios').serialize();
            if (servicios) {
                $.post("@Url.Action("ReturnServicios", "Travels")", { servicios: servicios, serviciosids: servicesids }, res => {
                    $('.addServicios').hide();
                    $('.serviciosseleccionados').html(res).show('slow', () => { $('.serviciosseleccionados').show(); });
                    setTimeout(() => {
                        servicesobject && servicesobject.map(({
                            id,
                            costo,
                            idAerolinea,
                            buque,
                            idAgenteAduanal,
                            idChofer,
                            idCoLoader,
                            idContatctoA,
                            idContactoAA,
                            idContactoCL,
                            idNaviera,
                            idTransportista,
                            nombre,
                            precio,
                            travelId,
                            unidades
                        }) => {
                            $(`[name=${nombre}`).prop('checked', true);
                            $(`[name=${nombre}costo`).val(parseFloat(costo).toFixed(2));
                            $(`[name=${nombre}precio`).val(parseFloat(precio).toFixed(2));
                            $('#transportista').val(idTransportista).trigger('change');
                            setTimeout(() => {
                                $('#chofer').val(idChofer).trigger('change');

                            }, 300);
                            $('.equipocontainer').attr('rel', idTransportista);
                            let equipos = [];
                            unidades.map(({
                                id,
                                idUnidad,
                                idEquipo,
                                services,
                                servicesId
                            }) => {
                                const elementid = $('.equipocontainer').children().length;
                                equipos.push([elementid, idEquipo]);
                                $('#addEquipo').attr('onclick', `addEquipo('${nombre}', this);`);
                                document.getElementById('addEquipo').click();
                                setTimeout(() => $(`#unidad${elementid}`).val(idUnidad).trigger('change'), 1500);
                            });
                            setTimeout(() => {
                                equipos.map(([k, v]) => $(`#equipo${k}`).val(v).trigger('change'));
                            }, 2800);
                        });
                        setPrecios();
                        setCostos();
                    }, 800);
                });
            } else {
                $(`.addServicios`).show('slow', () => { $('.addServicios').show(); });
                $('.serviciosseleccionados').empty().hide();
            }
        }

        getServicios = () => {
            $.get(`/Travels/GetServicios/${TravelId}`, response => {
                let services = '';
                let servicesids = '';
                Object.entries(response).map(([k, { id, nombre }]) => {
                    services += `${nombre}&`;
                    servicesids += `${id}&`;
                });

                closeModal(services, response, servicesids);
            });
        }

        getMercanciaD = () => {
            $.post(`/Travels/GetMercancia/${TravelId}`, (response) => {
                Object.entries(response).map(([k, v]) => {
                    $(`[name=${k.toLowerCase()}`).val(v);
                });
            }).fail(function (error) {
                dToast("error", "Error al obtener la mercancia", "Error");
            });
        }

        postMercancia = form => {
            const data = jQuery(form).serializeArray();
            data.push({ name: 'TravelId', value: TravelId });

            $.post('/Travels/setMercancia', data, () => {
                dToast("success", "Guardado", "Exitoso");
            }).fail(error => {
                dToast("error", "Error al guardar los datos", "Error");
            });
        }

        getMercancia = () => {
            const TransportistaId = @Model.Transportista;
            if (TransportistaId > 0) {
            $.post(`/Carriers/Box/getBox/`, { Id_Transportista: TransportistaId }, response => {
                !response && dToast("error", "El transportista de este viaje no tiene parametros de mercancia", "Error");
                const { densidad, d_Opcional, tipoPresentacion, tp_Opcional, peligroso, material, m_Opcional, derramable, valor, v_Opcional, custodia, olorPenetrante, notas } = response;
                densidad && ($('#densidad').val(d_Opcional), $('[name=densidad]').attr('checked', true));
                tipoPresentacion && ($('#tipopresentacion').val(tp_Opcional), $('[name=tipopresentacion]').attr('checked', true));
                peligroso && $('[name=peligroso]').attr('checked', true);
                material && ($('#material').val(m_Opcional), $('[name=material').attr('checked', true));
                derramable && $('[name=derramable]').attr('checked', true);
                valor && ($('#valor').val(v_Opcional), $('[name=valor').attr('checked', true));
                custodia && $('[name=custodia]').attr('checked', true);
                olorPenetrante && $('[name=olorpenetrante]').attr('checked', true);
                $('[name=requisitosespeciales]').val(notas);
            });
            } else {
                dToast("error", "ES NECESARIO TENER SERVICIOS EN EL VIAJE PARA VER ESTA INFORMACIÓN", "Error");
            }
        }

        getRequisitos = () => {
            const clienteid = @Model.ClienteId;
            $.get(`/Clients/Requirements/getRequirements/?Id_Cliente=${clienteid}`, response => {
                !response && dToast("error", "El cliente de este viaje no tiene parametros de requisitos", "Error");
                response && Object.entries(response).map(([key, val]) => {
                    $(`[name=${key}]`).attr('checked', val);
                });
            });
        }

    showPanel = name => {
        $('.bottomPanel').children().hide();
        $(`.${name}`).removeClass('d-none').show();
    }

    selectFactura = element => {
        const elemento = jQuery(element);
        elemento.attr('disabled', true);
        $("#modalFactura").modal("show");
        }


    $(".custom-file-input").on("change", () => {
        const fileName = $(this).val().split("\\").pop();
        $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });

    UploadFile = () => {
        var formData = new FormData();
        var myfile = $('#customFile')[0].files[0];
        formData.append('file', $('#customFile')[0].files[0]);
        formData.append('TravelId', TravelId);
        if (myfile !== undefined) {
            $.ajax({
                url: "/Facturacion/UploadFile",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function (data) {
                    $("#modalDiv .close").click();
                    dToast("success", "Archivo guardado correctamente.", "Exitoso");
                    $('#formFactura')[0].reset();
                    loadTableFactura();
                    $.post('/Travels/SetHistorial', { accion: 'Añadió archivo en facturación' });
                },
                error: data => {
                    dToast("error", "Ocurrio un error al intentar guardar el archivo.", "Error");
                }
            });
        } else {
            dToast("error", "Seleccione un archivo.", "Error");
        }
    }

    downloadFile = (nombre, fullpath) => {
        const a = $("<a>")
            .attr("href", fullpath)
            .attr("download", nombre)
            .appendTo("body");

        a[0].click();

        a.remove();
    }

        loadTableFactura = () => {
            $('.table-facturas').DataTable().clear().destroy();
        $.get("/Facturacion/getFacturas", { TravelId: TravelId }, res => {
            res.map(({ nombre, fechacarga, usuario, fullpath }) => {
                $("#facturacionInfo").append(`
                        <tr>
                        <td>${nombre}</td>
                        <td>${moment(fechacarga).format('DD/MM/YYYY')}</td>
                        <td>${usuario}</td>
                        <td class="text-center">
                            <a href="javascript:void(0);" onclick="downloadFile('${nombre}','${fullpath}')">
                                <span class="material-icons">
                                    file_download
                                </span>
                            </a>
                        </td>
                    </tr>`);
            });
            dTable("table-facturas");
            $('.dataTables_length, .dataTables_filter, .dataTables_info').remove();
        }).fail(error => {
            dToast("error", "Error al tratar de obtener los registros, intenta cerrar sesión y volver a iniciar.", "Error");
        });
    }

        loadTableHistorial = () => {
            $('.table-historial').DataTable().clear().destroy();
        $.get("/Travels/GetHistorial", { TravelId: TravelId }, response => {
            response.map(({ registro, usuario, timeCreated }) => {
                $("#historialInfo").append(`
                    <tr>
                    <td>${registro}</td>
                    <td>${usuario}</td>
                    <td>${moment(timeCreated).format('DD/MM/YYYY')}</td>
                </tr>`);
            });
            dTable("table-historial");
            $('.dataTables_length, .dataTables_filter, .dataTables_info').remove();
        }).fail(error => {
            dToast("error", "Error al tratar de obtener los registros, intenta cerrar sesión y volver a iniciar.", "Error");
        });
    }

    selectServicios = element => {
        const elemento = jQuery(element);
        elemento.attr('disabled', true);
        $("#modalDiv").modal("show");
    }
    </script>
}
